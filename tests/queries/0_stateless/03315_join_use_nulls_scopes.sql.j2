DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;
DROP TABLE IF EXISTS t3;
DROP TABLE IF EXISTS t4;

CREATE TABLE t1 (a INT, b INT, c INT) ENGINE = MergeTree ORDER BY a;
CREATE TABLE t2 (a INT, b INT, c INT) ENGINE = MergeTree ORDER BY a;
CREATE TABLE t3 (a INT, b INT, c INT) ENGINE = MergeTree ORDER BY a;
CREATE TABLE t4 (a INT, b INT, c INT) ENGINE = MergeTree ORDER BY a;
CREATE TABLE t5 (a INT, b INT, c INT) ENGINE = MergeTree ORDER BY a;

INSERT INTO t1 VALUES (1, 20, 100), (2, 30, 200), (3, 40, 300), (1, 25, 150), (4, 50, 400);
INSERT INTO t2 VALUES (1, 10, 90), (2, 20, 180), (5, 30, 270), (1, 15, 95);
INSERT INTO t3 VALUES (1, 5, 80), (1, 15, 85), (2, 25, 175), (6, 35, 265);
INSERT INTO t4 VALUES (1, 12, 75), (2, 22, 165), (7, 32, 255), (1, 18, 78);
INSERT INTO t5 VALUES (1, 12, 75), (2, 22, 165), (7, 32, 255), (1, 18, 78);

{% for kind in ['LEFT', 'RIGHT', 'FULL'] -%}
{% for join_use_nulls in [[0,1,0], [1,0,1], [0,1,1]] -%}

SELECT '--- {{ kind }} {{ join_use_nulls }} ---';

SELECT ignore(* APPLY x -> x + 1), * APPLY toTypeName FROM (
    SELECT * FROM (
        SELECT * FROM t1
        {{ kind }} JOIN t2 ON t1.a = t2.a AND t1.b > t2.b AND t1.c > 1 AND t2.c > 1
        SETTINGS join_use_nulls = {{ join_use_nulls[0] }}
    ) t
    {{ kind }} JOIN t3 ON t3.a = t.a AND t3.b > t.a AND t3.c > 1
    -- enable when https://github.com/ClickHouse/ClickHouse/issues/75005 is fixed
    -- {{ kind }} JOIN t5 ON t5.a = t.a AND t5.b > t.a AND t5.c > 1
    SETTINGS join_use_nulls = {{ join_use_nulls[1] }}
) tt
{{ kind }} JOIN t4 ON t4.a = tt.a AND t4.b > tt.t3.a AND t4.c > 1
ORDER BY rand() LIMIT 1
SETTINGS join_use_nulls = {{ join_use_nulls[2] }}
;

{% endfor -%}
{% endfor -%}
